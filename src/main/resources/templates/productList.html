<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <title>TestyPie</title>
    <link rel="stylesheet" type="text/css" href="/css/header.css">
    <link rel="stylesheet" type="text/css" href="/css/productList.css">
    <link rel="stylesheet" type="text/css" href="/css/modal.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="/js/category.js"></script>
    <script src="/js/getNewToken.js"></script>

    <style>
        .container {
            max-width: 800px;
        }
    </style>
</head>
<div th:replace="fragments/header :: headerFragment"></div>
<body>	<!-- body 없어도 무방 -->
<div class="container" th:attr="data-parentname=${parentCategory_name}, data-childid=${childCategory_id}">
        <div id="search-container">
            <input type="text" id="search-input" placeholder="검색어 입력" />
            <button id="search-button">검색</button>
        </div>
        <div>
            <table class="table">
                <thead>
                <tr>
                    <th>글 번호</th>
                    <th>제목</th>
                    <th>좋아요</th>
                    <th>작성자</th>
                    <th>기한</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="product : ${productList}">
                    <td><a th:href="@{/api/category/{parent_name}/{children_id}/products/{productId}
                                                    (productId=${product.id}, parent_name=${product.parentCategoryName()}
                                                    , children_id=${product.childCategoryId()})}"
                           th:text="${product.id}"></a></td>
                    <td><a th:href="@{/api/category/{parent_name}/{children_id}/products/{productId}
                                                    (productId=${product.id}, parent_name=${product.parentCategoryName()}
                                                    , children_id=${product.childCategoryId()})}"
                           th:text="${product.title}"></a></td>
                    <td th:text="${product.productLikeCnt}"></td>
                    <td th:text="${product.nickname}" th:attr="onclick='fetchUserProfile(\'' + ${product.account} + '\')'"></td>

                    <td th:text="${product.message}"></td>
                </tr>
                </tbody>
            </table>
        </div>
        <div>
            <ul class="pagination">
                <li th:each="pageNum : ${#numbers.sequence(1, productList.totalPages)}" class="page-item">
                    <a th:href="@{/api/category/{parentCategory_name}/{childCategory_id}(parentCategory_name=${parentCategory_name}, childCategory_id=${childCategory_id}, page=${pageNum})}" th:text="${pageNum}" class="page-link">1</a>
                </li>
            </ul>
        </div>
        <a th:href="@{/api/category/{parentName}/{childId}/products(parentName=${parentCategory_name}, childId=${childCategory_id})}" class="btn btn-primary">게시글 작성</a>
            <div class="d-grid gap-2 col-6 mx-auto">

            </div>
        </div>
<th:block th:replace="fragments/modal.html"></th:block>
<script src="/js/modal.js"></script>
</body>
<script>
    $(document).ready(function() {
        $('#search-button').click(function() {
            var searchTerm = $('#search-input').val();
            var parentName = $(".container").data("parentname");
            var childId = $(".container").data("childid");
            var url = "/api/category" + "/" + parentName + "/" + childId +"/search"
            $.ajax({
                url: url,
                type: 'GET',
                data: {
                    keyword : searchTerm
                },
                success: function(data) {
                    // 검색 결과 처리
                    // 예: 검색 결과로 테이블 업데이트
                    updateTable(data);
                },
                error: function(error) {
                    console.log('Error:', error);
                }
            });
        });
    });
    function updateTable(data) {
        var tableBody = $('.table tbody');
        tableBody.empty(); // 테이블 내용을 비웁니다.
        console.log(data)
        data.content.forEach(function(product) {
            tableBody.append(
                '<tr>' +
                '<td>' + product.id + '</td>' +
                '<td>' + product.title + '</td>' +
                '<td>' + product.productLikeCnt + '</td>' +
                '<td onclick="fetchUserProfile(\'' + product.account + '\')">' + product.nickname + '</td>' +
                '<td>' + product.message + '</td>' +
                '</tr>'
            );
        });
    }
</script>
</html>
